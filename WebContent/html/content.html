<div class="row">
  <div class="col-lg-3 col-xs-6">
    <!-- small box -->
    <div class="small-box bg-red">
      <div class="inner">
        <h3>65</h3>
        <p>Current Users</p>
      </div>
      <div class="icon">
        <i class="ion ion-pie-graph"></i>
      </div>
      <a href="html/pages/users.html" class="small-box-footer">
        More info <i class="fa fa-arrow-circle-right"></i>
      </a>
    </div>
  </div>
  <!-- ./col -->

  <div class="col-lg-3 col-xs-6">
    <!-- small box -->
    <div class="small-box bg-aqua">
      <div class="inner">
        <h3>10</h3>
        <p>Number of Shows</p>
      </div>
      <div class="icon">
        <i class="fa fa-film"></i>
      </div>
      <a href="#" class="small-box-footer">
        More info <i class="fa fa-arrow-circle-right"></i>
      </a>
    </div>
  </div>
  <!-- ./col -->
  <div class="col-lg-3 col-xs-6">
    <!-- small box -->
    <div class="small-box bg-green">
      <div class="inner">
        <h3>70<sup style="font-size: 20px">%</sup></h3>
        <p>Feedback responses</p>
      </div>
      <div class="icon">
        <i class="fa fa-comments"></i>
      </div>
      <a href="html/pages/feedback.html" class="small-box-footer">
        More info <i class="fa fa-arrow-circle-right"></i>
      </a>
    </div>
  </div>
  <!-- ./col -->
  <div class="col-lg-3 col-xs-6">
    <!-- small box -->
    <div class="small-box bg-yellow">
      <div class="inner">
        <h3>94</h3>
        <p>Total Users</p>
      </div>
      <div class="icon">
        <i class="ion ion-person-add"></i>
      </div>
      <a href="html/pages/users.html" class="small-box-footer">
        More info <i class="fa fa-arrow-circle-right"></i>
      </a>
    </div>
  </div>
  <!-- ./col -->
</div>
<!-- /.row -->

<!-- MAIN FORM -->
<div class="row">
  <!-- left column for charts -->
  <div class="col-md-6">
    <!-- BAR CHART -->
    <div class="box box-success">
      <div class="box-header with-border">
        <h3 class="box-title">Bar Chart</h3>

        <div class="box-tools pull-right">
          <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
          <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
        </div>
      </div>
      <div class="box-body">
        <div class="chart">
          <canvas id="barChart" style="height:230px"></canvas>
        </div>
      </div>
      <!-- /.box-body -->
    </div>
    <!-- /.box -->

    <!-- DONUT CHART -->
    <!-- <div class="box box-danger">
      <div class="box-header with-border">
        <h3 class="box-title">Donut Chart</h3>

        <div class="box-tools pull-right">
          <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                </button>
          <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
        </div>
      </div>
      <div class="box-body">
        <canvas id="pieChart" style="height:250px"></canvas>
      </div>
      <!-- /.box-body -->
    <!-- </div> -->
    <!-- /.box -->

    <!-- Map CHART -->
    <div class="box box-success">
      <div class="box-header with-border">
        <h3 class="box-title">Users by country</h3>

        <div class="box-tools pull-right">
          <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
          <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
        </div>
      </div>
      <!-- /.box-header -->
      <div class="box-body no-padding">
        <div class="pad">
          <!-- Map will be created here -->
          <div id="world-map-markers" style="height: 325px;"></div>
        </div>
      </div>
      <!-- /.box-body -->
    </div>
    <!-- /.box -->

    <!-- Word cloud CHART -->
    <div class="box box-success">
      <div class="box-header with-border">
        <h3 class="box-title">Feedback analysis</h3>

        <div class="box-tools pull-right">
          <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
          <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
        </div>
      </div>
      <!-- /.box-header -->
      <div class="box-body no-padding">
        <div class="pad">
          <!-- You should explicitly specify the dimensions of the container element -->
          <div id="wordcloud" style="width: 100%; height: 350px;"></div>
        </div>
      </div>
      <!-- /.box-body -->
    </div>
    <!-- /.box -->
  </div>

  <!-- right column for forms -->
  <div class="col-md-6">
    <!-- add question for game FORM -->
    <div class="box box-primary">
      <div class="box-header with-border">
        <h3 class="box-title">Add Questions for Game</h3>

        <div class="box-tools pull-right">
          <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
          <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
        </div>
      </div>
      <!-- /.box-header -->
      <!-- form start -->
      <form role="form" id="questionform" name="questionform">
        <div class="box-body">
          <div class="form-group">
            <label for="gamequestion">Question</label>
            <input type="text" class="form-control" name="gamequestion" placeholder="Enter question">
          </div>
          <label>Enter Answer Option 1</label>
          <div class="input-group">
            <span class="input-group-addon">
                <input type="radio" name="gameanswer" value="0">
              </span>
            <input type="text" class="form-control" name="option1" placeholder="Enter answer option 1">
          </div>
          <!-- /input-group -->
          <label>Enter Answer Option 2</label>
          <div class="input-group">
            <span class="input-group-addon">
                <input type="radio" name="gameanswer" value="1">
              </span>
            <input type="text" class="form-control" name="option2" placeholder="Enter answer option 2">
          </div>
          <!-- /input-group -->
          <label>Enter Answer Option 3</label>
          <div class="input-group">
            <span class="input-group-addon">
                <input type="radio" name="gameanswer" value="2">
              </span>
            <input type="text" class="form-control" name="option3" placeholder="Enter answer option 3">
          </div>
          <!-- /input-group -->
        </div>
        <!-- /.box-body -->

        <div class="box-footer">
          <button type="submit" class="btn btn-primary" id="questionformbutton">Submit</button>
        </div>
      </form>
    </div>

    <!-- add feedback FORM -->
    <div class="box box-primary">
      <div class="box-header with-border">
        <h3 class="box-title">Add a new feedback question</h3>

        <div class="box-tools pull-right">
          <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
          <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
        </div>
      </div>
      <!-- /.box-header -->
      <!-- form start -->
      <form role="form" id="feedbackForm">
        <div class="box-body">
          <!-- select -->
          <div class="form-group">
            <label>Select the show</label>
            <select class="form-control" id="selectShows1" name="showName">
            </select>
          </div>
          <div class="form-group">
            <label for="gamequestion">Question</label>
            <input type="text" class="form-control" name="feedbackQuestion" placeholder="Enter your feedback question">
          </div>
          <!-- /input-group -->
          <label>Enter Answer Option 1</label>
          <div class="form-group">
            <input type="text" class="form-control" name="option1" placeholder="Enter answer option 1">
          </div>
          <!-- /input-group -->
          <label>Enter Answer Option 2</label>
          <div class="form-group">
            <input type="text" class="form-control" name="option2" placeholder="Enter answer option 2">
          </div>
          <!-- /input-group -->
          <label>Enter Answer Option 3</label>
          <div class="form-group">
            <input type="text" class="form-control" name="option3" placeholder="Enter answer option 3">
          </div>
          <!-- /input-group -->
        </div>
        <!-- /.box-body -->

        <div class="box-footer">
          <button type="submit" class="btn btn-primary">Submit</button>
        </div>
      </form>
    </div>

    <!-- add push event FORM -->
    <div class="box box-primary">
      <div class="box-header with-border">
        <h3 class="box-title">Push event notification for show</h3>

        <div class="box-tools pull-right">
          <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
          <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
        </div>
      </div>
      <!-- /.box-header -->
      <!-- form start -->
      <form role="form" id="pushEventForm">
        <div class="box-body">
          <!-- select -->
          <div class="form-group">
            <label>Select the show</label>
            <select class="form-control" id="selectShows2" name="showName">
            </select>
          </div>
          <div class="form-group">
            <label for="gamequestion">Enter the link here</label>
            <input type="url" class="form-control" name="trailerLink" placeholder="Enter trailer link">
          </div>
        </div>
        <!-- /.box-body -->

        <div class="box-footer">
          <button type="submit" class="btn btn-primary">Submit</button>
        </div>
      </form>
    </div>

    <!-- add new show FORM -->
    <div class="box box-primary">
      <div class="box-header with-border">
        <h3 class="box-title">Add a new show?</h3>

        <div class="box-tools pull-right">
          <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
          <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
        </div>
      </div>
      <!-- /.box-header -->

      <!-- form start -->
      <form role="form" name="addshowform" id="addshowform">
        <div class="box-body">
          <div class="form-group">
            <label for="gamequestion">Enter the show name</label>
            <input type="text" class="form-control" name="showname" placeholder="Enter Show Name">
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="gamequestion">Enter the show start timing</label>
                <input type="time" class="form-control" name="starttime" placeholder="Enter Show start time">
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label for="gamequestion">Enter the show end timing</label>
                <input type="time" class="form-control" name="endtime" placeholder="Enter Show end time">
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="gamequestion">Enter the show image</label>
            <input type="url" class="form-control" name="showimage" placeholder="Enter show image link here">
          </div>

          <div class="form-group">
            <label for="gamequestion">Enter the show trailer link</label>
            <input type="url" class="form-control" name="showtrailer" placeholder="Enter Show trailer link">
          </div>

          <div class="form-group">
            <label for="gamequestion">Enter the show tags</label>
            <input type="text" class="form-control" name="showtags" placeholder="Enter Show tags seperated by tags">
          </div>

        </div>
        <!-- /.box-body -->

        <div class="box-footer">
          <button type="submit" class="btn btn-primary">Submit</button>
        </div>
      </form>
    </div>

  </div>

</div>


<script>
  $(function() {
    /* ChartJS
     * -------
     * Here we will create a few charts using ChartJS
     */

    //-------------
    //- BAR CHART -
    //-------------
    var barChartCanvas = $('#barChart').get(0).getContext('2d')
    var barChart = new Chart(barChartCanvas)
    var barChartData = {
      labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
      datasets: [{
          label: 'Electronics',
          fillColor: 'rgba(210, 214, 222, 1)',
          strokeColor: 'rgba(210, 214, 222, 1)',
          pointColor: 'rgba(210, 214, 222, 1)',
          pointStrokeColor: '#c1c7d1',
          pointHighlightFill: '#fff',
          pointHighlightStroke: 'rgba(220,220,220,1)',
          data: [65, 59, 80, 81, 56, 55, 40]
        },
        {
          label: 'Digital Goods',
          fillColor: 'rgba(60,141,188,0.9)',
          strokeColor: 'rgba(60,141,188,0.8)',
          pointColor: '#3b8bba',
          pointStrokeColor: 'rgba(60,141,188,1)',
          pointHighlightFill: '#fff',
          pointHighlightStroke: 'rgba(60,141,188,1)',
          data: [28, 48, 40, 19, 86, 27, 90]
        }
      ]
    }
    barChartData.datasets[1].fillColor = '#00a65a'
    barChartData.datasets[1].strokeColor = '#00a65a'
    barChartData.datasets[1].pointColor = '#00a65a'
    var barChartOptions = {
      //Boolean - Whether the scale should start at zero, or an order of magnitude down from the lowest value
      scaleBeginAtZero: true,
      //Boolean - Whether grid lines are shown across the chart
      scaleShowGridLines: true,
      //String - Colour of the grid lines
      scaleGridLineColor: 'rgba(0,0,0,.05)',
      //Number - Width of the grid lines
      scaleGridLineWidth: 1,
      //Boolean - Whether to show horizontal lines (except X axis)
      scaleShowHorizontalLines: true,
      //Boolean - Whether to show vertical lines (except Y axis)
      scaleShowVerticalLines: true,
      //Boolean - If there is a stroke on each bar
      barShowStroke: true,
      //Number - Pixel width of the bar stroke
      barStrokeWidth: 2,
      //Number - Spacing between each of the X value sets
      barValueSpacing: 5,
      //Number - Spacing between data sets within X values
      barDatasetSpacing: 1,
      //String - A legend template
      legendTemplate: '<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].fillColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>',
      //Boolean - whether to make the chart responsive
      responsive: true,
      maintainAspectRatio: true
    }

    barChartOptions.datasetFill = false
    barChart.Bar(barChartData, barChartOptions);

    $.ajax({
      url: '/dashboard/getShowDataByCountry'
    }).then(function(response) {
      // jvectormap data
      var visitorsData = response;

      // World map by jvectormap
      $('#world-map-markers').vectorMap({
        map: 'world_mill_en',
        backgroundColor: 'transparent',
        regionStyle: {
          initial: {
            fill: '#e4e4e4',
            'fill-opacity': 1,
            stroke: 'none',
            'stroke-width': 0,
            'stroke-opacity': 1
          }
        },
        series: {
          regions: [{
            values: visitorsData,
            scale: ['#92c1dc', '#ebf4f9'],
            normalizeFunction: 'polynomial'
          }]
        },
        onRegionLabelShow: function(e, el, code) {
          if (typeof visitorsData[code] != 'undefined')
            el.html(el.html() + ': ' + visitorsData[code] + ' new visitors');
        }
      });
    });

    $.ajax({
      url: 'dashboard/getTagsfromReviews'
    }).then(function(response) {
      console.log(response);
      /* jQCloud Word Cloud
       * ------------
       * Create an array of word objects, each representing a word in the cloud
       */
      var word_array = [];
      for (var key in response) {
        if (response.hasOwnProperty(key)) {
          word_array.push({
            text: key,
            weight: response[key]
          })
        }
      }
      $("#wordcloud").jQCloud(word_array);
    });

    $.ajax({
      url: 'dashboard/getShows'
    }).then(function(response) {
      console.log(response);
      $("#selectShows1").populate(response);
      $("#selectShows2").populate(response);
    });

    $('#questionform').on('submit', function(e) {
      $.LoadingOverlay("show");
      e.preventDefault();
      var dataArray = $(this).serializeArray();
      var data = objectifyForm(dataArray);
      var options =[data.option1, data.option2, data.option3];
      var body = {
        "show": "",
        "options": options,
        "answer": options[data.gameanswer],
        "type": "quiz",
        "qn": data.gamequestion
      }

      console.log(body);

      var settings = {
        "async": true,
        "url": "dashboard/saveAllQuestions",
        "method": "POST",
        "headers": {
          "content-type": "application/json",
          "cache-control": "no-cache",
          "postman-token": "150979a6-a36f-daae-86e7-bb48de5352a8"
        },
        "data": JSON.stringify(body)
      }

      $.ajax(settings)
        .done(function(response) {
          console.log(response);
        })
        .always(function() {
          $.LoadingOverlay("hide");
          $("#questionform")[0].reset();
        });
    });

    $('#feedbackForm').on('submit', function(e) {
      $.LoadingOverlay("show");
      e.preventDefault();
      var dataArray = $(this).serializeArray();
      var data = objectifyForm(dataArray);
      var options =[data.option1, data.option2, data.option3];
      var body = {
        "show": data.showName,
        "options": options,
        "answer": "",
        "type": "feedback",
        "qn": data.feedbackQuestion
      }

      console.log(body);

      var settings = {
        "async": true,
        "url": "dashboard/saveAllQuestions",
        "method": "POST",
        "headers": {
          "content-type": "application/json",
          "cache-control": "no-cache",
          "postman-token": "150979a6-a36f-daae-86e7-bb48de5352a8"
        },
        "data": JSON.stringify(body)
      }

      $.ajax(settings)
        .done(function(response) {
          console.log(response);
        })
        .always(function() {
          $.LoadingOverlay("hide");
          $("#feedbackForm")[0].reset();
        });
    });

    $('#pushEventForm').on('submit', function(e) {
      var dataArray = $(this).serializeArray();
      var data = objectifyForm(dataArray);
      console.log(data); //use the console for debugging, F12 in Chrome, not alerts
      e.preventDefault();
    });

    $('#addshowform').on('submit', function(e) {
      var dataArray = $(this).serializeArray();
      var data = objectifyForm(dataArray);
      console.log(data); //use the console for debugging, F12 in Chrome, not alerts
      e.preventDefault();
    });

    //serialize data function
    function objectifyForm(formArray) {
      var returnArray = {};
      for (var i = 0; i < formArray.length; i++) {
        returnArray[formArray[i]['name']] = formArray[i]['value'];
      }
      return returnArray;
    }

    $.fn.populate = function(optionArray) {
      for (var i = 0; i < optionArray.length; i++) {
        var option = optionArray[i]["name"];
        $(this).append('<option value="' + option + '">' + option + '</option>');
      }
    }

  });
</script>
